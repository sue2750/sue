<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>私密日记本</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#a5d8ff',
                        secondary: '#ffc9de',
                        accent: '#d8bbff',
                        dark: '#4a5568'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .bg-gradient-custom {
                background: linear-gradient(135deg, #ffc9de 0%, #a5d8ff 50%, #d8bbff 100%);
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 密码保护页面 -->
    <div id="password-protection" class="fixed inset-0 bg-gradient-custom flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h1 class="text-3xl font-bold text-center mb-6 bg-gradient-to-r from-pink-400 via-blue-400 to-purple-400 bg-clip-text text-transparent">
                私密日记本
            </h1>
            <p class="text-gray-600 text-center mb-6">请输入密码访问您的私人日记</p>
            <div class="space-y-4">
                <div>
                    <input type="password" id="password-input" placeholder="请输入密码" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                </div>
                <button id="login-btn" class="w-full bg-gradient-to-r from-pink-400 via-blue-400 to-purple-400 text-white py-3 rounded-lg font-medium hover:opacity-90 transition-opacity">
                    登录
                </button>
                <p id="error-message" class="text-red-500 text-center hidden">密码错误，请重试</p>
            </div>
        </div>
    </div>

    <!-- 主应用 -->
    <div id="app" class="hidden">
        <!-- 顶部导航 -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-pink-400 via-blue-400 to-purple-400 bg-clip-text text-transparent">
                        我的日记本
                    </h1>
                    <div class="flex space-x-3">
                        <button id="new-diary-btn" class="bg-blue-400 text-white px-4 py-2 rounded-lg hover:bg-blue-500 transition-colors">
                            <i class="fa fa-plus mr-2"></i>写日记
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容 -->
        <main class="container mx-auto px-4 py-8">
            <!-- 日记列表 -->
            <div id="diary-list" class="space-y-4">
                <!-- 日记将在这里动态生成 -->
            </div>

            <!-- 空状态 -->
            <div id="empty-state" class="text-center py-16 hidden">
                <i class="fa fa-book text-5xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-medium text-gray-600 mb-2">还没有日记</h3>
                <p class="text-gray-500">点击"写日记"按钮开始记录您的第一篇日记</p>
            </div>
        </main>
    </div>

    <!-- 写日记模态框 -->
    <div id="diary-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">写日记</h2>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: 60vh;">
                <div class="space-y-4">
                    <div>
                        <label for="diary-title" class="block text-sm font-medium text-gray-700 mb-1">标题</label>
                        <input type="text" id="diary-title" placeholder="给今天的日记起个标题..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                    </div>
                    <div>
                        <label for="diary-content" class="block text-sm font-medium text-gray-700 mb-1">内容</label>
                        <textarea id="diary-content" rows="10" placeholder="今天发生了什么呢？记录下来吧..." 
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none"></textarea>
                    </div>
                    <div>
                        <label for="diary-tags" class="block text-sm font-medium text-gray-700 mb-1">标签（用逗号分隔）</label>
                        <input type="text" id="diary-tags" placeholder="开心, 工作, 学习..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent">
                    </div>
                </div>
            </div>
            <div class="p-6 border-t bg-gray-50">
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-500" id="current-date"></span>
                    <div class="flex space-x-3">
                        <button id="cancel-diary" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            取消
                        </button>
                        <button id="save-diary" class="px-4 py-2 bg-blue-400 text-white rounded-lg hover:bg-blue-500">
                            保存日记
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日记详情模态框 -->
    <div id="diary-detail-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h2 id="detail-title" class="text-xl font-bold"></h2>
                    <div class="flex space-x-2">
                        <button id="edit-diary" class="text-gray-500 hover:text-gray-700">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button id="delete-diary" class="text-gray-500 hover:text-gray-700">
                            <i class="fa fa-trash"></i>
                        </button>
                        <button id="close-detail" class="text-gray-500 hover:text-gray-700">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: 60vh;">
                <div class="space-y-4">
                    <div class="text-sm text-gray-500" id="detail-date"></div>
                    <div id="detail-content" class="whitespace-pre-wrap text-gray-800 leading-relaxed"></div>
                    <div class="pt-4 border-t">
                        <div class="flex flex-wrap gap-2" id="detail-tags"></div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t bg-gray-50">
                <button id="close-detail-btn" class="w-full px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <script>
        // 应用状态
        const app = {
            password: 'hu616823',
            diaries: [],
            currentDiaryIndex: -1,
            isEditing: false
        };

        // DOM 元素
        const elements = {
            passwordProtection: document.getElementById('password-protection'),
            passwordInput: document.getElementById('password-input'),
            loginBtn: document.getElementById('login-btn'),
            errorMessage: document.getElementById('error-message'),
            app: document.getElementById('app'),
            newDiaryBtn: document.getElementById('new-diary-btn'),
            diaryList: document.getElementById('diary-list'),
            emptyState: document.getElementById('empty-state'),
            diaryModal: document.getElementById('diary-modal'),
            closeModal: document.getElementById('close-modal'),
            diaryTitle: document.getElementById('diary-title'),
            diaryContent: document.getElementById('diary-content'),
            diaryTags: document.getElementById('diary-tags'),
            currentDate: document.getElementById('current-date'),
            cancelDiary: document.getElementById('cancel-diary'),
            saveDiary: document.getElementById('save-diary'),
            diaryDetailModal: document.getElementById('diary-detail-modal'),
            detailTitle: document.getElementById('detail-title'),
            detailDate: document.getElementById('detail-date'),
            detailContent: document.getElementById('detail-content'),
            detailTags: document.getElementById('detail-tags'),
            editDiary: document.getElementById('edit-diary'),
            deleteDiary: document.getElementById('delete-diary'),
            closeDetail: document.getElementById('close-detail'),
            closeDetailBtn: document.getElementById('close-detail-btn')
        };

        // 初始化应用
        function init() {
            loadDiaries();
            setupEventListeners();
            updateCurrentDate();
        }

        // 从本地存储加载日记
        function loadDiaries() {
            const saved = localStorage.getItem('privateDiaries');
            if (saved) {
                app.diaries = JSON.parse(saved);
                renderDiaries();
            }
        }

        // 保存日记到本地存储
        function saveDiaries() {
            localStorage.setItem('privateDiaries', JSON.stringify(app.diaries));
            renderDiaries();
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 密码登录
            elements.loginBtn.addEventListener('click', handleLogin);
            elements.passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });

            // 新建日记
            elements.newDiaryBtn.addEventListener('click', () => {
                openNewDiaryModal();
            });

            // 日记模态框
            elements.closeModal.addEventListener('click', closeDiaryModal);
            elements.cancelDiary.addEventListener('click', closeDiaryModal);
            elements.saveDiary.addEventListener('click', saveDiary);

            // 日记详情模态框
            elements.closeDetail.addEventListener('click', closeDetailModal);
            elements.closeDetailBtn.addEventListener('click', closeDetailModal);
            elements.editDiary.addEventListener('click', editCurrentDiary);
            elements.deleteDiary.addEventListener('click', deleteCurrentDiary);

            // 点击模态框背景关闭
            elements.diaryModal.addEventListener('click', (e) => {
                if (e.target === elements.diaryModal) closeDiaryModal();
            });

            elements.diaryDetailModal.addEventListener('click', (e) => {
                if (e.target === elements.diaryDetailModal) closeDetailModal();
            });

            // 自动保存
            elements.diaryContent.addEventListener('input', debounce(autoSaveDraft, 1000));
            elements.diaryTitle.addEventListener('input', debounce(autoSaveDraft, 1000));
            elements.diaryTags.addEventListener('input', debounce(autoSaveDraft, 1000));
        }

        // 处理登录
        function handleLogin() {
            const password = elements.passwordInput.value.trim();
            if (password === app.password) {
                elements.passwordProtection.classList.add('hidden');
                elements.app.classList.remove('hidden');
            } else {
                elements.errorMessage.classList.remove('hidden');
                setTimeout(() => {
                    elements.errorMessage.classList.add('hidden');
                }, 3000);
            }
            elements.passwordInput.value = '';
        }

        // 打开新建日记模态框
        function openNewDiaryModal() {
            app.isEditing = false;
            app.currentDiaryIndex = -1;
            
            // 清除表单
            elements.diaryTitle.value = '';
            elements.diaryContent.value = '';
            elements.diaryTags.value = '';
            
            // 显示模态框
            elements.diaryModal.classList.remove('hidden');
            elements.diaryModal.classList.add('flex');
            
            // 聚焦到标题输入框
            elements.diaryTitle.focus();
            
            // 加载草稿（如果有）
            loadDraft();
        }

        // 关闭日记模态框
        function closeDiaryModal() {
            elements.diaryModal.classList.add('hidden');
            elements.diaryModal.classList.remove('flex');
            
            // 保存草稿
            saveDraft();
        }

        // 保存日记
        function saveDiary() {
            const title = elements.diaryTitle.value.trim();
            const content = elements.diaryContent.value.trim();
            
            if (!title) {
                showToast('请输入日记标题', 'error');
                elements.diaryTitle.focus();
                return;
            }
            
            if (!content) {
                showToast('请输入日记内容', 'error');
                elements.diaryContent.focus();
                return;
            }
            
            const tags = elements.diaryTags.value.trim()
                .split(',')
                .map(tag => tag.trim())
                .filter(tag => tag.length > 0);
            
            const diary = {
                id: Date.now(),
                title: title,
                content: content,
                tags: tags,
                date: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (app.isEditing && app.currentDiaryIndex !== -1) {
                // 编辑现有日记
                diary.id = app.diaries[app.currentDiaryIndex].id;
                diary.date = app.diaries[app.currentDiaryIndex].date;
                app.diaries[app.currentDiaryIndex] = diary;
                showToast('日记更新成功', 'success');
            } else {
                // 新建日记
                app.diaries.unshift(diary);
                showToast('日记保存成功', 'success');
            }
            
            saveDiaries();
            closeDiaryModal();
            
            // 清除草稿
            clearDraft();
        }

        // 渲染日记列表
        function renderDiaries() {
            elements.diaryList.innerHTML = '';
            
            if (app.diaries.length === 0) {
                elements.emptyState.classList.remove('hidden');
                elements.diaryList.classList.add('hidden');
                return;
            }
            
            elements.emptyState.classList.add('hidden');
            elements.diaryList.classList.remove('hidden');
            
            app.diaries.forEach((diary, index) => {
                const diaryCard = document.createElement('div');
                diaryCard.className = 'bg-white rounded-lg shadow p-6 card-hover cursor-pointer';
                
                const preview = diary.content.substring(0, 100) + (diary.content.length > 100 ? '...' : '');
                
                diaryCard.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-semibold text-gray-900">${escapeHtml(diary.title)}</h3>
                        <span class="text-sm text-gray-500">${formatDate(diary.date)}</span>
                    </div>
                    <p class="text-gray-600 mb-4 line-clamp-3">${escapeHtml(preview)}</p>
                    ${diary.tags.length > 0 ? `
                        <div class="flex flex-wrap gap-2">
                            ${diary.tags.map(tag => `
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                                    ${escapeHtml(tag)}
                                </span>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
                
                diaryCard.addEventListener('click', () => openDiaryDetail(index));
                elements.diaryList.appendChild(diaryCard);
            });
        }

        // 打开日记详情
        function openDiaryDetail(index) {
            app.currentDiaryIndex = index;
            const diary = app.diaries[index];
            
            elements.detailTitle.textContent = diary.title;
            elements.detailDate.textContent = formatFullDate(diary.date);
            elements.detailContent.textContent = diary.content;
            
            // 渲染标签
            elements.detailTags.innerHTML = diary.tags.map(tag => `
                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                    ${escapeHtml(tag)}
                </span>
            `).join('');
            
            elements.diaryDetailModal.classList.remove('hidden');
            elements.diaryDetailModal.classList.add('flex');
        }

        // 关闭详情模态框
        function closeDetailModal() {
            elements.diaryDetailModal.classList.add('hidden');
            elements.diaryDetailModal.classList.remove('flex');
        }

        // 编辑当前日记
        function editCurrentDiary() {
            if (app.currentDiaryIndex !== -1) {
                const diary = app.diaries[app.currentDiaryIndex];
                
                app.isEditing = true;
                
                elements.diaryTitle.value = diary.title;
                elements.diaryContent.value = diary.content;
                elements.diaryTags.value = diary.tags.join(', ');
                
                closeDetailModal();
                
                elements.diaryModal.classList.remove('hidden');
                elements.diaryModal.classList.add('flex');
                
                elements.diaryContent.focus();
            }
        }

        // 删除当前日记
        function deleteCurrentDiary() {
            if (app.currentDiaryIndex !== -1) {
                const diary = app.diaries[app.currentDiaryIndex];
                
                if (confirm(`确定要删除日记 "${diary.title}" 吗？`)) {
                    app.diaries.splice(app.currentDiaryIndex, 1);
                    saveDiaries();
                    closeDetailModal();
                    showToast('日记删除成功', 'success');
                }
            }
        }

        // 更新当前日期
        function updateCurrentDate() {
            elements.currentDate.textContent = formatFullDate(new Date().toISOString());
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                month: 'short',
                day: 'numeric'
            });
        }

        // 格式化完整日期
        function formatFullDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // 显示提示消息
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };
            
            toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fa ${icons[type]} mr-3 text-xl"></i>
                    <p class="font-medium">${message}</p>
                </div>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('animate-fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // HTML转义
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 自动保存草稿
        function autoSaveDraft() {
            const draft = {
                title: elements.diaryTitle.value,
                content: elements.diaryContent.value,
                tags: elements.diaryTags.value,
                timestamp: Date.now()
            };
            localStorage.setItem('diaryDraft', JSON.stringify(draft));
        }

        // 保存草稿
        function saveDraft() {
            const title = elements.diaryTitle.value.trim();
            const content = elements.diaryContent.value.trim();
            
            if (title || content) {
                const draft = {
                    title: title,
                    content: content,
                    tags: elements.diaryTags.value.trim(),
                    timestamp: Date.now()
                };
                localStorage.setItem('diaryDraft', JSON.stringify(draft));
            }
        }

        // 加载草稿
        function loadDraft() {
            const saved = localStorage.getItem('diaryDraft');
            if (saved) {
                const draft = JSON.parse(saved);
                const now = Date.now();
                const draftTime = draft.timestamp || 0;
                
                // 如果草稿是在24小时内保存的，询问是否恢复
                if (now - draftTime < 24 * 60 * 60 * 1000 && (draft.title || draft.content)) {
                    if (confirm('检测到未完成的草稿，是否恢复？')) {
                        elements.diaryTitle.value = draft.title || '';
                        elements.diaryContent.value = draft.content || '';
                        elements.diaryTags.value = draft.tags || '';
                    } else {
                        clearDraft();
                    }
                }
            }
        }

        // 清除草稿
        function clearDraft() {
            localStorage.removeItem('diaryDraft');
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>